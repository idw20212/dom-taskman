<!DOCTYPE html>
<html lang="pt-br">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manipulação do DOM</title>
    <script>
      /**
       * Um vetor com a lista das tarefas.
       */
       var tarefas = [
        {
          id: 1,
          titulo: "Tomar água",
          dataDeTermino: new Date(2021, 7, 14),
          estahConcluida: false,
        },
        {
          id: 2,
          titulo: "Escrever introdução do TCC",
          dataDeTermino: new Date(2021, 7, 20),
          estahConcluida: false,
        },
        {
          id: 3,
          titulo: "Concluir tarefa de IDW",
          dataDeTermino: new Date(2021, 7, 30),
          estahConcluida: false,
        },
      ];

      /**
       * Tratador do evento de click do botão que
       * marca uma tarefa como concluída ou desmarca como concluída
       * de acordo com a situação da tarefa relacionada.
       * 
       * O código opera da seguinte forma:
       * - obtém o valor do atributo `data-tarefas-id` do botão
       * - encontra a tarefa correspondente na lista de tarefas
       * - alterna o valor do atributo `estahConcluida`
       * - chama o método `apresentarTarefas()` para atualizar a lista das tarefas
       */
       function buttonConcluirTarefaClick() {
        var id = this.getAttribute('data-tarefas-id');
        var tarefa = tarefas.find(t => t.id == id);
        tarefa.estahConcluida = !tarefa.estahConcluida;
        apresentarTarefas();
      }      

      /**
       * Método que cria o botão de marcar a tarefa como concluída ou desfazer
       * desfazer a conclusão, de acordo com a situação da tarefa
       * informada como parâmetro `tarefa`.
       * 
       * O código opera da seguinte forma:
       * - cria um elemento `button`
       * - define o valor do atributo `innerHTML` de acordo com a situação da tarefa
       * - define o valor do atributo `data-tarefas-id` do botão como o valor do atributo `id` da `tarefa`
       * - adiciona o tratador do evento de click no botão (`buttonConcluirTarefaClick`)
       * - retorna elemento `button`.
       */
       function createButtonConcluir(tarefa) {
        var btnConcluir = document.createElement('button');
        if (tarefa.estahConcluida) {
          btnConcluir.innerHTML = 'Desfazer concluir';
        } else {
          btnConcluir.innerHTML = 'Concluída';
        }
        btnConcluir.setAttribute('data-tarefas-id', tarefa.id);
        btnConcluir.addEventListener('click', buttonConcluirTarefaClick);
        return btnConcluir;
      } 

      /**
       * Método que apresenta a lista das tarefas.
       */
       function apresentarTarefas() {
        var table = document.getElementById('tableTarefas');
        var tbody = document.getElementById('tbodyTarefas');
        if (tbody) {
          tbody.remove();
        }
        tbody = document.createElement('tbody');
        tbody.setAttribute('id', 'tbodyTarefas');
        table.appendChild(tbody);
        for (var tarefa of tarefas) {
          var tr = document.createElement('tr');
          tr.setAttribute('id', `rowTarefas-${tarefa.id}`);
          if (tarefa.estahConcluida) {
            tr.style.backgroundColor = 'lightgreen';
          }
          var tdId = document.createElement('td');
          tdId.innerHTML = tarefa.id;
          var tdTitulo = document.createElement('td');
          if (tarefa.estahConcluida) {
            var stTitulo = document.createElement('strike');
            stTitulo.innerHTML = tarefa.titulo;
            tdTitulo.appendChild(stTitulo);
          } else {
            tdTitulo.innerHTML = tarefa.titulo;
          }
          var tdTermino = document.createElement('td');
          tdTermino.innerHTML = tarefa.dataDeTermino;
          var tdConcluir = document.createElement('td');
          btnConcluir = createButtonConcluir(tarefa);
          tdConcluir.appendChild(btnConcluir);
          tr.appendChild(tdId);
          tr.appendChild(tdTitulo);
          tr.appendChild(tdTermino);
          tr.appendChild(tdConcluir);
          tbody.appendChild(tr);
        }
      }

      /**
       * Tratador do evento DOMContentLoaded para o document.
       */
      function documentLoad() {
        apresentarTarefas();
      }

      /**
       * Define o tratador do evento DOMContentLoaded do document.
       */
      document.addEventListener('DOMContentLoaded', documentLoad);
    </script>
  </head>

  <body>
    <div id="app">
      <h1 id="title">Gerenciador de tarefas</h1>
      <h4 id="subtitle">Demonstração de recursos de manipulação do DOM com JavaScript</h4>
      <hr>
      <table id="tableTarefas" border="1">
        <thead>
          <tr>
            <th>Id</th>
            <th>Tarefa</th>
            <th>Conclusão</th>
            <th>Concluir</th>
          </tr>
        </thead>
        <tbody id="tbodyTarefas">
        </tbody>
      </table>
    </div>
  </body>

</html>